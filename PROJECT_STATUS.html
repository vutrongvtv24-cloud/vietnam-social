<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√†i li·ªáu D·ª± √Ån - Vietnam Social</title>
    <!-- GitHub Markdown CSS -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-light.min.css">
    <style>
        body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
            background-color: #f6f8fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        @media (max-width: 767px) {
            body {
                padding: 15px;
            }
        }

        .markdown-body {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 40px;
            border-radius: 8px;
            background: #fff;
        }

        /* Mermaid styling fix */
        .mermaid {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: #fcfcfc;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <article class="markdown-body" id="content">
        <!-- Markdown rendered content will appear here -->
    </article>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <!-- Raw Markdown Data -->
    <script id="raw-markdown" type="text/markdown">
# üìò T√†i Li·ªáu K·ªπ Thu·∫≠t: Vietnam Social

> **D·ª± √°n:** Vietnam Social (M·∫°ng x√£ h·ªôi cho Builders)  
> **Phi√™n b·∫£n:** 2.1.0 (Admin Power Update)  
> **C·∫≠p nh·∫≠t l·∫ßn cu·ªëi:** 21/01/2026

---

## 1. T·ªïng Quan H·ªá Th·ªëng

**Vietnam Social** l√† n·ªÅn t·∫£ng m·∫°ng x√£ h·ªôi t·∫≠p trung v√†o vi·ªác chia s·∫ª ki·∫øn th·ª©c, k·∫øt n·ªëi c·ªông ƒë·ªìng builder, v√† h·ªçc t·∫≠p. D·ª± √°n s·ª≠ d·ª•ng stack hi·ªán ƒë·∫°i v·ªõi **Next.js 16** cho Frontend v√† **Supabase** cho Backend/Database.

### üèõÔ∏è Ki·∫øn Tr√∫c C√¥ng Ngh·ªá

```mermaid
graph TD
    A[User Client] -->|Next.js App Router| B(Frontend: Vercel)
    B -->|Supabase Client| C{Supabase Backend}
    C -->|Postgres| D[(Database)]
    C -->|Realtime| A
    C -->|Auth| E[Authentication]
    
    subgraph "Core Features"
    F[Feed System]
    G[Approval System]
    H[Gamification]
    I[Courses]
    J[Admin Dashboard]
    end
```

---

## 2. Logic Nghi·ªáp V·ª• Ch√≠nh (Core Logic)

### üìå A. Quy Tr√¨nh Duy·ªát B√†i (Post Approval)

ƒê·ªÉ ƒë·∫£m b·∫£o ch·∫•t l∆∞·ª£ng n·ªôi dung, h·ªá th·ªëng √°p d·ª•ng c∆° ch·∫ø duy·ªát b√†i nghi√™m ng·∫∑t k·∫øt h·ª£p gi·ªØa Admin v√† C·ªông ƒë·ªìng.

**Quy t·∫Øc:**
1.  **B√†i vi·∫øt m·ªõi** s·∫Ω m·∫∑c ƒë·ªãnh ·ªü tr·∫°ng th√°i `Pending` (Ch·ªù duy·ªát).
2.  **Admin** (vutrongvtv24@gmail.com) c√≥ quy·ªÅn **Duy·ªát (Approve)** ho·∫∑c **T·ª´ ch·ªëi (Reject)** ngay l·∫≠p t·ª©c.
3.  **C·ªông ƒë·ªìng** c√≥ th·ªÉ tham gia duy·ªát b·∫±ng n√∫t **"Vote OK"**.
4.  Khi s·ªë vote **l·ªõn h∆°n 50% t·ªïng s·ªë users** c·ªßa h·ªá th·ªëng -> B√†i vi·∫øt **T·ª± ƒë·ªông Approved**.

```mermaid
stateDiagram-v2
    [*] --> Pending: User ƒëƒÉng b√†i
    Pending --> Approved: Admin Approve
    Pending --> Rejected: Admin Reject
    Pending --> Deleted: Admin/Author Delete
    Pending --> Pending: User Votes
    
    state "Ki·ªÉm tra Vote (>50%)" as CheckVote
    Pending --> CheckVote: C√≥ vote m·ªõi
    CheckVote --> Approved: ƒê·ªß ƒëi·ªÅu ki·ªán (>50%)
    CheckVote --> Pending: Ch∆∞a ƒë·ªß
    
    Approved --> [*]: Hi·ªÉn th·ªã Public
    Rejected --> [*]: ·∫®n b√†i vi·∫øt
    Deleted --> [*]: X√≥a vƒ©nh vi·ªÖn
```

### üëÆ B. Admin Privileges (Quy·ªÅn Qu·∫£n Tr·ªã)

Ng∆∞·ªùi qu·∫£n tr·ªã h·ªá th·ªëng (c·∫£ Global Admin v√† Community Admin) c√≥ c√°c quy·ªÅn ƒë·∫∑c bi·ªát ƒë·ªÉ duy tr√¨ tr·∫≠t t·ª± c·ªông ƒë·ªìng:

*   **X√≥a b√†i vi·∫øt:** Admin c√≥ th·ªÉ x√≥a b·∫•t k·ª≥ b√†i vi·∫øt n√†o vi ph·∫°m quy t·∫Øc.
*   **Block User:** Admin c√≥ th·ªÉ block ng∆∞·ªùi d√πng, ngƒÉn h·ªç ƒëƒÉng b√†i ho·∫∑c tham gia c·ªông ƒë·ªìng.
*   **Qu·∫£n l√Ω th√†nh vi√™n:** Admin c√≥ th·ªÉ Duy·ªát (Approve), T·ª´ ch·ªëi (Reject) ho·∫∑c Block th√†nh vi√™n trong c√°c Community Group.

### üéÆ C. Gamification (T√≠nh ƒêi·ªÉm & Level)

Ng∆∞·ªùi d√πng ƒë∆∞·ª£c khuy·∫øn kh√≠ch t∆∞∆°ng t√°c th√¥ng qua h·ªá th·ªëng ƒëi·ªÉm kinh nghi·ªám (XP) v√† C·∫•p ƒë·ªô (Level).

*   **Logic:** XP t√≠ch l≈©y t·ª´ c√°c h√†nh ƒë·ªông (ƒêƒÉng b√†i = 10xp, Like = 2xp...).
*   **Hi·ªÉn th·ªã:** Level hi·ªán t·∫°i hi·ªÉn th·ªã c·∫°nh t√™n ng∆∞·ªùi d√πng (VD: `Level 5 Builder`).
*   **M·ª•c ƒë√≠ch:** Level cao c√≥ th·ªÉ m·ªü kh√≥a c√°c t√≠nh nƒÉng ƒë·∫∑c bi·ªát (v√≠ d·ª•: truy c·∫≠p Course n√¢ng cao).

### üí¨ D. B√¨nh Lu·∫≠n Realtime

H·ªá th·ªëng s·ª≠ d·ª•ng **Supabase Realtime** ƒë·ªÉ c·∫≠p nh·∫≠t b√¨nh lu·∫≠n ngay l·∫≠p t·ª©c m√† kh√¥ng c·∫ßn F5 trang web.

---

## 3. C·∫•u Tr√∫c C∆° S·ªü D·ªØ Li·ªáu (Database Schema)

D∆∞·ªõi ƒë√¢y l√† c√°c b·∫£ng ch√≠nh trong h·ªá th·ªëng:

```mermaid
erDiagram
    PROFILES ||--o{ POSTS : "creates"
    PROFILES ||--o{ COMMENTS : "writes"
    PROFILES ||--o{ LIKES : "likes"
    PROFILES ||--o{ POST_APPROVALS : "votes"
    
    POSTS ||--o{ COMMENTS : "has"
    POSTS ||--o{ LIKES : "has"
    POSTS ||--o{ POST_APPROVALS : "validated by"

    PROFILES {
        uuid id PK
        string full_name
        int level
        int xp
        text status "('active', 'blocked')"
        text role "('admin', 'user')"
    }

    POSTS {
        uuid id PK
        uuid user_id FK
        text content
        text status "('pending', 'approved', 'rejected')"
        uuid community_id
    }

    POST_APPROVALS {
        uuid id PK
        uuid post_id FK
        uuid user_id FK
        timestamp created_at
    }
```

---

## 4. C·∫•u Tr√∫c Th∆∞ M·ª•c (Source Code)

*   `src/app`: Ch·ª©a c√°c trang ch√≠nh (App Router).
    *   `/`: Trang ch·ªß (Home Feed).
    *   `/class/[slug]`: Trang chi ti·∫øt Community Group.
    *   `/profile/[id]`: Trang c√° nh√¢n.
*   `src/components`: UI Components.
    *   `/feed`: PostCard (ƒë√£ t√≠ch h·ª£p Admin Actions), Feed.
*   `supabase/migrations`: Ch·ª©a SQL migrations (m·ªõi nh·∫•t: `fix_admin_permissions.sql`).

---

## 5. Tr·∫°ng Th√°i Hi·ªán T·∫°i

| T√≠nh nƒÉng | Tr·∫°ng th√°i | Ghi ch√∫ |
| :--- | :---: | :--- |
| **ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω** | ‚úÖ Ho√†n th√†nh | Google Auth |
| **News Feed** | ‚úÖ Ho√†n th√†nh | Infinite Scroll |
| **ƒêƒÉng b√†i vi·∫øt** | ‚úÖ Ho√†n th√†nh | H·ªó tr·ª£ ·∫£nh, Text |
| **Realtime Comment** | ‚úÖ Ho√†n th√†nh | |
| **Duy·ªát b√†i (Admin)** | ‚úÖ Ho√†n th√†nh | Policy b·∫£o m·∫≠t OK |
| **X√≥a b√†i (Admin)** | ‚úÖ Ho√†n th√†nh | Dropdown Menu |
| **Block User** | ‚úÖ Ho√†n th√†nh | NgƒÉn user ƒëƒÉng nh·∫≠p/t∆∞∆°ng t√°c |
| **Qu·∫£n l√Ω Th√†nh vi√™n** | ‚úÖ Ho√†n th√†nh | Approve/Reject/Block trong Group |
| **Vote duy·ªát (User)** | ‚úÖ Ho√†n th√†nh | Logic > 50% OK |
| **Courses UI** | üöß Placeholder | ƒêang ph√°t tri·ªÉn n·ªôi dung |

---

> **Note cho Developer:** Khi c√†i ƒë·∫∑t l·∫°i d·ª± √°n, b·∫Øt bu·ªôc ph·∫£i ch·∫°y file SQL migration m·ªõi nh·∫•t ƒë·ªÉ t·∫°o b·∫£ng `post_approvals` v√† c·ªôt `status`.

    </script>

    <script>
        // Render Markdown
        const markdownInput = document.getElementById('raw-markdown').innerHTML;
        const contentDiv = document.getElementById('content');
        contentDiv.innerHTML = marked.parse(markdownInput);
    </script>
</body>

</html>